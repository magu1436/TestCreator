{% extends "base.html" %}

{% block title %}
OCR画面
{% endblock %}

{% block loadcss %}
{% load static %}
<script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js" defer></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="{% static 'ocr/css/interface.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<!-- ocr/interface.html の左カラム例（右側は既存の単語テーブルを配置） -->
<div class="row g-4">
  <!-- 左：アップロード -->
  <div class="col-12 col-lg-5">
    <div class="card shadow-sm">
      <div class="card-header d-flex align-items-center justify-content-between">
        <span class="fw-bold">画像アップロード（OCR）</span>
        <span class="badge bg-secondary" id="file-count">0 枚</span>
      </div>

      <!-- 初期状態 / 共通 -->
      <div id="dropzone" class="card-body">
        <div id="init-dropzone-body" class="border border-2 border-dashed rounded-3 p-4 text-center bg-light">
          <div class="mb-2">
            <i class="bi bi-cloud-upload fs-1"></i>
          </div>
          <p class="mb-1">ここに画像をドラッグ＆ドロップ</p>
          <p class="text-muted small mb-3">または</p>
          <div>
            <label class="btn btn-outline-primary">
              画像を選択
              <input type="file" id="file-input" name="files" accept="image/*" multiple hidden>
            </label>
          </div>
          <p class="text-muted small mt-3">対応: JPEG / PNG、最大 10MB/枚（目安）</p>
        </div>
        <div id="body-uploaded" class="d-flex flex-column"></div>

        <!-- 選択概要 -->
        <div class="d-flex align-items-center justify-content-between mt-3">
          <div class="small text-muted">合計サイズ: <span id="total-size">0</span> MB</div>
          <div>
            <button id="upload-btn" class="btn btn-primary">アップロード開始</button>
          </div>
        </div>

        <!-- 全体進捗 -->
        <div class="mt-3 d-none" id="overall-progress-wrap">
          <div class="d-flex justify-content-between small mb-1">
            <span>全体進捗</span><span id="overall-percent">0%</span>
          </div>
          <div class="progress" role="progressbar" aria-label="overall" aria-valuemin="0" aria-valuemax="100">
            <div class="progress-bar" id="overall-progress" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 右：単語テーブル（既存をここに） -->
  <div class="col-12 col-lg-7 d-flex flex-column flex-grow-1 h-100 mx-auto">
    {% include 'vocab/word-table.html' %}

    <div class="d-flex flex-row flex-shrink-0 gap-2 mb-2">
      <button id="delete-btn" type="button" class="btn btn-secondary text-center">
        削除
      </button>
      <button id="register-btn" type="button" class="btn btn-secondary text-center">
        登録
      </button>
    </div>
  </div>
</div>

{% endblock %}

{% block loadjs %}
<script type="importmap">
{
  "imports": {
    "@shared/": "{% static 'shared/dist/' %}",
    "@vocab/": "{% static 'vocab/js/dist/' %}",
    "js-cookie": "https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.mjs"
  }
}
</script>
<script id="app-urls" type="application/json">
{
    "vocab:editor": "{% url 'vocab:editor' %}",
    "vocab:register": "{% url 'vocab:register' %}",
    "vocab:delete": "{% url 'vocab:delete' %}",
    "vocab:update": "{% url 'vocab:update' %}",
    "wordbank:create": "{% url 'wordbank:create' %}",
    "wordbank:delete": "{% url 'wordbank:delete' %}",
    "wordbank:read": "{% url 'wordbank:read' %}",
    "wordbank:all_wordlist": "{% url 'wordbank:all_wordlist' %}",
    "ocr:ocr": "{% url 'ocr:ocr' %}"
}
</script>
<script type="module" src="{% static 'ocr/js/dist/interface.js' %}"></script>
{% endblock %}